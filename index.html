<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Pro Sender - Env√≠o Masivo Autom√°tico</title>
    <meta name="description" content="Software profesional para env√≠o masivo de WhatsApp. Demo gratis de 20 mensajes. Automatiza tu marketing por WhatsApp.">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --whatsapp-green: #25D366;
            --whatsapp-dark: #075E54;
            --whatsapp-light: #DCF8C6;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .hero-section {
            background: linear-gradient(135deg, var(--whatsapp-dark) 0%, var(--whatsapp-green) 100%);
            color: white;
            padding: 80px 0;
        }
        
        .btn-whatsapp {
            background-color: var(--whatsapp-green);
            border-color: var(--whatsapp-green);
            color: white;
            font-weight: bold;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 50px;
            transition: all 0.3s ease;
        }
        
        .btn-whatsapp:hover {
            background-color: var(--whatsapp-dark);
            border-color: var(--whatsapp-dark);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .feature-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            height: 100%;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .demo-section {
            background-color: #f8f9fa;
        }
        
        .contact-section {
            background: linear-gradient(45deg, var(--whatsapp-green), var(--whatsapp-dark));
            color: white;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #f0f0f0;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px dashed #ccc;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .testimonial {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        .price-highlight {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
        }

        /* Estilos para indicadores de carga */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <!-- HERO SECTION -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold mb-4">
                        <i class="fab fa-whatsapp"></i> Automatiza whatsApp y aumenta tus ventas en minutos
                    </h1>
                    <h2 class="h3 mb-4">WhatsApp Pro Sender v3.0 ‚Äì Env√≠a 200+ mensajes con un solo clic</h2>
                    <p class="lead mb-4">
                        Comprueba que funciona de verdad: 
                        <strong>Env√≠a tu primer mensaje hoy mismo.</strong> Demo gratis sin tarjeta.
                    </p>
                    <div class="d-grid gap-2 d-md-flex">
                        <a href="#demo" class="btn btn-warning btn-lg pulse me-md-2">
                            üéØ PROBAR GRATIS AHORA
                        </a>
                        <a href="#beneficios" class="btn btn-outline-light btn-lg">
                            üìπ Ver como funciona
                        </a>
                    </div>
                </div>
                <div class="col-lg-6 text-center">
                <div class="p-5 bg-light rounded shadow-lg">
                    <i class="fab fa-whatsapp fa-5x text-success mb-3"></i>
                    <h3 class="text-success mb-3">WhatsApp Pro Sender v3.0</h3>
                    <p class="lead text-muted mb-3">Software Profesional de Env√≠o Masivo</p>
                    <div class="row g-2 text-center mb-3">
                        <div class="col-4">
                            <div class="badge bg-success p-2 w-100">
                                <small>20 Mensajes<br>GRATIS</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="badge bg-primary p-2 w-100">
                                <small>S√∫per<br>R√°pido</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="badge bg-warning p-2 w-100">
                                <small>Pago<br>√önico</small>
                            </div>
                        </div>
                    </div>
                    <div class="badge bg-dark text-light fs-6">‚ú® 100% Automatizado</div>
                </div>
            </div>
            </div>
        </div>
    </section>

    <!-- BENEFICIOS SECTION -->
    <section id="beneficios" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">
                <i class="fas fa-check-circle text-success"></i> 
                ¬øPor qu√© cada d√≠a m√°s empresas migran a WhatsApp Pro Sender?
            </h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="fas fa-gift fa-3x text-warning"></i>
                            </div>
                            <h5 class="card-title">üéØ Prueba real sin trucos</h5>
                            <p class="card-text">
                                Env√≠a 20 mensajes reales, personalizados y automatizados. 
                                Pru√©balo sin tarjeta. Comprueba que funciona en tu negocio.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="fas fa-bolt fa-3x text-primary"></i>
                            </div>
                            <h5 class="card-title">‚ö° ‚ö° Automatizaci√≥n Inteligente </h5>
                            <p class="card-text">
                                Mientras t√∫ vendes, atiendes o lideras...
                                WhatsApp Pro Sender env√≠a mensajes personalizados por ti. Sin copiar-pegar. Sin distracciones.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card feature-card h-100">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="fas fa-dollar-sign fa-3x text-success"></i>
                            </div>
                            <h5 class="card-title">üí∞ Licencia Vitalicia ‚Äì Solo $25 USD</h5>
                            <p class="card-text">
                                Un solo pago. Para siempre. 
                                Recupera horas de trabajo cada semana y elimina tareas repetitivas.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- DEMO SECTION -->
    <section id="demo" class="demo-section py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <h2 class="mb-4">
                        <i class="fas fa-play-circle"></i> 
                        Mira c√≥mo WhatsApp Pro Sender trabaja por ti.
                        Automatiza cada mensaje mientras t√∫ haces crecer tu negocio.
                    </h2>
                    <p class="lead mb-4">
                        En solo 2:30 minutos ver√°s c√≥mo el software env√≠a m√°s de 200 mensajes sin que tengas que mover un dedo.
                    </p>
                    
    <!-- Video Demo Integrado -->
    <div class="video-container mb-4" style="height: auto; background: none; border: none;">
        <div class="ratio ratio-16x9">
            <iframe 
                src="https://www.youtube.com/embed/0M2OpE7lObs?rel=0&showinfo=0&modestbranding=1" 
                title="WhatsApp Pro Sender Demo" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen
                style="border-radius: 15px;">
            </iframe>
        </div>
        
        <!-- Botones debajo del video -->
        <div class="text-center mt-3">
            <div class="row g-2 justify-content-center">
                <div class="col-md-6">
                    <a href="https://drive.google.com/uc?id=TU_ID_DE_GOOGLE_DRIVE" 
                       class="btn btn-whatsapp w-100" 
                       onclick="trackDownload()">
                        <i class="fas fa-download"></i> 
                        DESCARGAR DEMO GRATIS
                    </a>
                </div>
                <div class="col-md-6">
                    <a href="https://wa.me/51921566036?text=Vi%20el%20video%20demo%2C%20quiero%20m√°s%20informaci√≥n" 
                       class="btn btn-outline-success w-100">
                        <i class="fab fa-whatsapp"></i> 
                        CONSULTAR AHORA
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Estad√≠sticas del video -->
    <div class="row text-center mt-4">
        <div class="col-4">
            <div class="border rounded p-3">
                <h4 class="text-success mb-1">2:30</h4>
                <small class="text-muted">Duraci√≥n</small>
            </div>
        </div>
        <div class="col-4">
            <div class="border rounded p-3">
                <h4 class="text-primary mb-1">200+</h4>
                <small class="text-muted">Mensajes Mostrados</small>
            </div>
        </div>
        <div class="col-4">
            <div class="border rounded p-3">
                <h4 class="text-warning mb-1">15min</h4>
                <small class="text-muted">Tiempo Total</small>
            </div>
        </div>
    </div>
                    
                    <div class="price-highlight mb-4">
                        <h4> OFERTA DE LANZAMIENTO</h4>
                        <p class="mb-0">Demo GRATIS Lista para Usar</p>
                        <small>Env√≠a 20 mensajes automatizados HOY MISMO
                               Sin tarjeta. Sin instalaci√≥n dif√≠cil. Sin esperas.</small>
                    </div>
                    
                    <a href="https://drive.google.com/file/d/1Kh92E9IahqeIe_oCSGn62aE3ihs5Pv4g/view?usp=sharing" 
                       class="btn btn-whatsapp btn-lg mb-3" 
                       onclick="trackDownload()">
                        <i class="fas fa-download"></i> 
                         QUIERO ENVIAR MIS 20 MENSAJES GRATIS
                    </a>
                    
                    <p class="text-muted">
                        <i class="fas fa-shield-alt"></i> 
                        Archivo seguro ‚Ä¢ Sin virus ‚Ä¢ Instalaci√≥n inmediata
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- CARACTER√çSTICAS -->
    <section class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">¬øQu√© Hace WhatsApp Pro Sender tan poderoso?</h2>
            <div class="row">
                <div class="col-lg-6">
                    <ul class="list-unstyled">
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Empieza en minutos </strong> (sin curva de aprendizaje)
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Sube tu excel</strong> con un clic
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Personaliza mensajes </strong> autom√°ticamente con el nombre de cada cliente
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Interfaz tan simple</strong> que no necesitas tutoriales
                        </li>
                    </ul>
                </div>
                <div class="col-lg-6">
                    <ul class="list-unstyled">
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Detecci√≥n de n√∫meros inv√°lidos</strong>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Recuperaci√≥n autom√°tica</strong> de sesi√≥n
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Interfaz s√∫per f√°cil</strong> de usar
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Soporte t√©cnico incluido</strong>
                        </li>
                        <li class="mb-3">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Dedica ese tiempo a cerrar ventas o liderar tu negocio</strong> WhatsApp trabaja por ti, en segundo plano

                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- TESTIMONIAL PLACEHOLDER -->
    <section class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-5">üí¨ Lo Que Dicen Nuestros Usuarios</h2>
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="testimonial text-center">
                        <p class="lead">
                            "Incre√≠ble herramienta. En mi veterinaria enviamos recordatorios 
                            de vacunas a 300 clientes en 20 minutos. Antes nos tomaba todo el d√≠a."
                        </p>
                        <footer class="blockquote-footer">
                            Dr. Mar√≠a Gonz√°lez, <cite title="Veterinaria San Borja">Veterinaria San Borja</cite>
                        </footer>
                    </div>
                </div>
            </div>
        </div>
    </section>

    
<!-- SECCI√ìN COMPRAR LICENCIA COMPLETA -->
    <section class="py-5" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white;">
        <div class="container text-center">
            <h2 class="mb-4">üîì Ya Probaste... Ahora desbloquea todo el poder</h2>
            <p class="lead mb-4">
                Activa tu licencia vitalicia en 1 solo paso.
                Sin suscripciones, sin cargos ocultos, sin esperas.
            </p>
            
            <div class="row justify-content-center mb-4">
                <div class="col-md-8">
                    <div class="card bg-light text-dark">
                        <div class="card-body">
                            <h4 class="text-success">üí∞ ACCESO COMPLETO ‚Äì PAGA SOLO UNA VEZ </h4>
                            <h2 class="mb-3"> Act√≠valo hoy por solo $25 USD <small class="text-muted"> ‚Äì sin pagos mensuales</small></h2>
                            <ul class="list-unstyled text-start mb-4">
                                <li>‚úÖ Mensajes ilimitados para siempre</li>
                                <li>‚úÖ Todas las funciones desbloqueadas</li>
                                <li>‚úÖ Soporte t√©cnico prioritario (en espa√±ol)</li>
                                <li>‚úÖ Actualizaciones gratis</li>
                                <li>‚úÖ Garant√≠a 60 d√≠as</li>
                            </ul>
                            
                            <button class="btn btn-success btn-lg w-100 pulse" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#checkoutModal"
                                    onclick="trackPurchaseIntent()">
                                üîì QUIERO ACCESO COMPLETO PARA SIEMPRE
                            </button>
                            
                            <p class="small text-muted mt-3">
                                üí≥ PayPal ‚Ä¢ üè¶ Transferencia ‚Ä¢ üì± Yape/Plin
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- CONTACTO SECTION -->
    <section class="contact-section py-5">
        <div class="container text-center">
            <h2 class="mb-4">
                <i class="fas fa-headset"></i> 
                ¬øPreguntas? ¬°Cont√°ctanos!
            </h2>
            <p class="lead mb-4">
                Soporte t√©cnico personalizado incluido con tu licencia
            </p>
            
            <div class="row g-3 justify-content-center">
                <div class="col-md-6">
                    <a href="https://wa.me/51921566036?text=Hola%2C%20quiero%20informaci√≥n%20sobre%20WhatsApp%20Pro%20Sender" 
                       class="btn btn-light btn-lg w-100">
                        <i class="fab fa-whatsapp text-success"></i> 
                        WhatsApp: +51 921 566 036
                    </a>
                </div>
                <div class="col-md-6">
                    <a href="mailto:cortega@antayperu.com?subject=Consulta WhatsApp Pro Sender" 
                       class="btn btn-outline-light btn-lg w-100">
                        <i class="fas fa-envelope"></i> 
                        cortega@antayperu.com
                    </a>
                </div>
            </div>
            
            <p class="mt-4 mb-0">
                <i class="fas fa-clock"></i> 
                Respuesta en menos de 24 horas ‚Ä¢ Soporte en espa√±ol
            </p>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-dark text-light py-4">
        <div class="container text-center">
            <p class="mb-2">
                &copy; 2025 WhatsApp Pro Sender v3.0 - Desarrollado en Per√∫ üáµüá™
            </p>
            <p class="mb-0 text-muted">
                Software profesional para automatizaci√≥n de marketing por WhatsApp
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Google Analytics (reemplazar con tu ID) -->
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WBG7B6E2V0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag("js", new Date());
        gtag("config", "G-WBG7B6E2V0");
        
        // Eventos personalizados para tracking
        function trackDownload() {
            gtag("event", "download", {
                "event_category": "engagement",
                "event_label": "demo_download",
                "value": 1
            });
            console.log("Download tracked!");
        }
        
        function trackWhatsApp() {
            gtag("event", "whatsapp_click", {
                "event_category": "contact",
                "event_label": "whatsapp_button",
                "value": 1
            });
            console.log("WhatsApp click tracked!");
        }
        
        // Tracking autom√°tico de scroll
        let scrollTracked = false;
        window.addEventListener("scroll", function() {
            if (!scrollTracked && window.scrollY > 500) {
                gtag("event", "scroll_deep", {
                    "event_category": "engagement",
                    "event_label": "scrolled_500px",
                    "value": 1
                });
                scrollTracked = true;
                console.log("Deep scroll tracked!");
            }
        });

// =====================================
// SISTEMA CRM AUTOM√ÅTICO OPTIMIZADO - WhatsApp Pro Sender  
// =====================================

const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbyRt4rVnl3fT8MCQLn-jdgOYsr6crXpP8PwzK2MG6CPCHOkcvGPZ65p26FPF10OrZGmIw/exec";

let datosClienteGlobal = {}; // Para guardar los datos del formulario
let isProcessing = false; // Para evitar m√∫ltiples env√≠os

// Funci√≥n para detectar dispositivo
function detectarDispositivo() {
    const width = window.innerWidth;
    if (width <= 768) return "M√≥vil";
    if (width <= 1024) return "Tablet";
    return "Desktop";
}

// Funci√≥n para obtener datos adicionales con timeout optimizado
async function obtenerDatosAdicionales() {
    try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 3000); // Timeout de 3 segundos
        
        const response = await fetch("https://ipapi.co/json/", {
            signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        
        const data = await response.json();
        return {
            ip: data.ip || "No disponible",
            pais_detectado: data.country_name || "No detectado",
            ciudad: data.city || "No detectada"
        };
    } catch (error) {
        console.warn("‚ö†Ô∏è No se pudieron obtener datos adicionales:", error.message);
        return { 
            ip: "No disponible", 
            pais_detectado: "No detectado", 
            ciudad: "No detectada" 
        };
    }
}

// Funci√≥n principal para enviar datos al CRM (SOLO AL FINAL DEL PROCESO) - MEJORADA
async function enviarDatosACRM(datosFormulario) {
    try {
        console.log("üöÄ Enviando datos al CRM autom√°tico (REGISTRO FINAL)...");
        
        const datosAdicionales = await obtenerDatosAdicionales();
        
        // Mapeo correcto de los campos del formulario
        const payload = {
            nombre: datosFormulario.customerName || datosFormulario.name,
            email: datosFormulario.customerEmail || datosFormulario.email,
            whatsapp: datosFormulario.customerWhatsApp || datosFormulario.whatsapp,
            pais: datosFormulario.customerCountry || datosFormulario.country,
            hardwareId: datosFormulario.hardwareId,
            metodoPago: datosFormulario.metodoPago || "Pendiente selecci√≥n",
            fuente: document.referrer || "DIRECTO",
            dispositivo: detectarDispositivo(),
            ip: datosAdicionales.ip,
            navegador: navigator.userAgent.split(" ")[0],
            timestamp: new Date().toISOString(),
            estado: "VENTA_CONFIRMADA" // Nuevo campo para indicar que es una venta confirmada
        };
        
        console.log("üìä Datos finales a enviar:", payload);
        
        return new Promise((resolve, reject) => {
            // Crear funci√≥n callback √∫nica
            const callbackName = "crmCallback_" + Date.now();
            
            // Timeout mejorado para m√≥viles
            const timeoutId = setTimeout(() => {
                if (window[callbackName]) {
                    delete window[callbackName];
                    const script = document.querySelector(`script[src*="${callbackName}"]`);
                    if (script && script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                }
                reject(new Error("La conexi√≥n tard√≥ demasiado. Por favor, verifica tu conexi√≥n a internet e int√©ntalo de nuevo."));
            }, 15000); // 15 segundos de timeout para m√≥viles
            
            // Definir callback global
            window[callbackName] = function(resultado) {
                clearTimeout(timeoutId);
                console.log("‚úÖ Respuesta del CRM:", resultado);
                
                if (resultado.duplicado) {
                    console.warn("‚ö†Ô∏è ALERTA: Hardware ID duplicado detectado");
                }
                
                // Tracking para analytics
                if (typeof gtag !== "undefined") {
                    gtag("event", "crm_sale_confirmed", {
                        "event_category": "CRM",
                        "event_label": "Venta confirmada - Datos enviados",
                        "value": 25
                    });
                }
                
                // Limpiar callback de forma segura
                try {
                    delete window[callbackName];
                    const script = document.querySelector(`script[src*="${callbackName}"]`);
                    if (script && script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                } catch (cleanupError) {
                    console.warn("‚ö†Ô∏è Error menor al limpiar callback:", cleanupError);
                }
                
                resolve(resultado);
            };
            
            // Crear script JSONP con manejo de errores mejorado
            const script = document.createElement("script");
            const url = WEBHOOK_URL +
                "?callback=" + callbackName +
                "&data=" + encodeURIComponent(JSON.stringify(payload));
            
            script.src = url;
            script.onerror = function() {
                clearTimeout(timeoutId);
                try {
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.parentNode.removeChild(script);
                    }
                } catch (cleanupError) {
                    console.warn("‚ö†Ô∏è Error menor al limpiar script:", cleanupError);
                }
                reject(new Error("Error de conexi√≥n. Verifica tu conexi√≥n a internet e int√©ntalo de nuevo."));
            };
            
            // Agregar script al DOM
            try {
                document.head.appendChild(script);
            } catch (appendError) {
                clearTimeout(timeoutId);
                reject(new Error("Error interno. Por favor, recarga la p√°gina e int√©ntalo de nuevo."));
            }
        });
        
    } catch (error) {
        console.error("‚ùå Error enviando datos al CRM:", error);
        return { success: false, error: error.message };
    }
}

// Funci√≥n para limpiar el formulario despu√©s del env√≠o exitoso
function limpiarFormulario() {
    try {
        // Limpiar campos del formulario
        document.getElementById("customerName").value = "";
        document.getElementById("customerEmail").value = "";
        document.getElementById("customerWhatsApp").value = "";
        document.getElementById("customerCountry").selectedIndex = 0;
        document.getElementById("hardwareId").value = "";
        
        // Limpiar datos globales
        datosClienteGlobal = {};
        
        // Resetear estado de procesamiento
        isProcessing = false;
        
        // Ocultar detalles de pago
        document.getElementById("paypalDetails").style.display = "none";
        document.getElementById("bankDetails").style.display = "none";
        document.getElementById("yapePlinDetails").style.display = "none";
        
        // Quitar selecci√≥n de m√©todos de pago
        document.querySelectorAll(".payment-method").forEach(card => {
            card.classList.remove("border-primary", "border-3");
        });
        
        // Volver al paso 1
        document.getElementById("step2").style.display = "none";
        document.getElementById("step1").style.display = "block";
        
        console.log("‚úÖ Formulario limpiado exitosamente");
        
    } catch (error) {
        console.error("‚ùå Error al limpiar formulario:", error);
    }
}

// Funci√≥n para mostrar/ocultar instrucciones de Hardware ID
function showHardwareInstructions() {
    const instructionsDiv = document.getElementById("hardwareInstructions");
    if (instructionsDiv.style.display === "none") {
        instructionsDiv.style.display = "block";
    } else {
        instructionsDiv.style.display = "none";
    }
}

// Funci√≥n para mostrar indicador de carga en bot√≥n
function showButtonLoading(buttonElement, originalText) {
    buttonElement.innerHTML = `<span class="loading-spinner"></span> Procesando...`;
    buttonElement.classList.add('btn-loading');
    buttonElement.setAttribute('data-original-text', originalText);
}

// Funci√≥n para ocultar indicador de carga en bot√≥n
function hideButtonLoading(buttonElement) {
    const originalText = buttonElement.getAttribute('data-original-text') || 'Continuar al Pago ‚Üí';
    buttonElement.innerHTML = originalText;
    buttonElement.classList.remove('btn-loading');
    buttonElement.removeAttribute('data-original-text');
}

// Funci√≥n OPTIMIZADA para ir al Paso 2 del checkout (SIN ENV√çO AL CRM)
function goToStep2() {
    // Prevenir m√∫ltiples env√≠os
    if (isProcessing) {
        console.log("‚ö†Ô∏è Ya se est√° procesando una solicitud...");
        return;
    }

    const form = document.getElementById("customerForm");
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }

    try {
        // Capturar datos CORREGIDOS (SIN ENVIAR AL CRM A√öN)
        const customerData = {
            customerName: document.getElementById("customerName").value,
            customerEmail: document.getElementById("customerEmail").value,
            customerWhatsApp: document.getElementById("customerWhatsApp").value,
            customerCountry: document.getElementById("customerCountry").value,
            hardwareId: document.getElementById("hardwareId").value
        };

        console.log("üìã Datos capturados del formulario (guardados localmente):", customerData);

        // Guardar datos globalmente SOLO EN MEMORIA
        datosClienteGlobal = customerData;

        // Actualizar resumen en Paso 2
        document.getElementById("summaryName").textContent = customerData.customerName;
        document.getElementById("summaryEmail").textContent = customerData.customerEmail;
        document.getElementById("summaryHardware").textContent = customerData.hardwareId;

        // Mostrar Paso 2 y ocultar Paso 1
        document.getElementById("step1").style.display = "none";
        document.getElementById("step2").style.display = "block";

        // Tracking para analytics
        if (typeof gtag !== "undefined") {
            gtag("event", "checkout_step2", {
                "event_category": "Checkout",
                "event_label": "Paso 2 - Seleccionar Pago",
                "value": 1
            });
        }

        console.log("‚úÖ Transici√≥n al Paso 2 completada (datos guardados en memoria)");

    } catch (error) {
        console.error("‚ùå Error en goToStep2:", error);
        alert(`Hubo un error al procesar tus datos: ${error.message}\n\nPor favor, int√©ntalo de nuevo.`);
    }
}

// Funci√≥n para seleccionar m√©todo de pago y mostrar detalles (SIN ENV√çO AL CRM)
function selectPaymentMethod(method) {
    // Ocultar todos los detalles de pago
    document.getElementById("paypalDetails").style.display = "none";
    document.getElementById("bankDetails").style.display = "none";
    document.getElementById("yapePlinDetails").style.display = "none";

    // Quitar selecci√≥n de todos los m√©todos
    document.querySelectorAll(".payment-method").forEach(card => {
        card.classList.remove("border-primary", "border-3");
    });

    // Mostrar el detalle del m√©todo seleccionado
    let selectedDetailsDiv;
    let selectedMethodName = "";
    switch (method) {
        case "paypal":
            selectedDetailsDiv = document.getElementById("paypalDetails");
            selectedMethodName = "PayPal";
            break;
        case "bank":
            selectedDetailsDiv = document.getElementById("bankDetails");
            selectedMethodName = "Transferencia Bancaria";
            break;
        case "yapeplin":
            selectedDetailsDiv = document.getElementById("yapePlinDetails");
            selectedMethodName = "Yape/Plin";
            break;
    }

    if (selectedDetailsDiv) {
        selectedDetailsDiv.style.display = "block";
        // A√±adir borde de selecci√≥n
        event.currentTarget.classList.add("border-primary", "border-3");

        // Actualizar el m√©todo de pago en datosClienteGlobal (SOLO EN MEMORIA)
        datosClienteGlobal.metodoPago = selectedMethodName;

        console.log("üí≥ M√©todo de pago seleccionado:", selectedMethodName, "(guardado en memoria)");

        // Tracking para analytics
        if (typeof gtag !== "undefined") {
            gtag("event", "payment_method_selected", {
                "event_category": "Checkout",
                "event_label": "M√©todo de Pago Seleccionado: " + selectedMethodName,
                "value": 1
            });
        }
    }
}

// Funci√≥n para trackear intenci√≥n de compra (cuando se abre el modal)
function trackPurchaseIntent() {
    if (typeof gtag !== "undefined") {
        gtag("event", "purchase_intent", {
            "event_category": "Checkout",
            "event_label": "Modal de checkout abierto",
            "value": 1
        });
    }
    console.log("Modal de checkout abierto - actualizando precios...");
    // Simular actualizaci√≥n de precios (si fuera din√°mico)
    setTimeout(() => {
        console.log("Precios actualizados correctamente");
        if (typeof gtag !== "undefined") {
            gtag("event", "price_updated", {
                "event_category": "Checkout",
                "event_label": "Precios actualizados: $25 USD",
                "value": 25
            });
        }
    }, 1000);
}

// Funci√≥n para volver al Paso 1 del checkout
function goToStep1() {
    // Ocultar Paso 2 y mostrar Paso 1
    document.getElementById("step2").style.display = "none";
    document.getElementById("step1").style.display = "block";

    // Tracking para analytics
    if (typeof gtag !== "undefined") {
        gtag("event", "checkout_back_to_step1", {
            "event_category": "Checkout",
            "event_label": "Volver a Paso 1 - Datos",
            "value": 1
        });
    }
}

// NUEVA FUNCI√ìN OPTIMIZADA: Enviar voucher por WhatsApp Y REGISTRAR EN CRM - MEJORADA
async function enviarVoucherWhatsApp(metodo) {
    // Validamos que tengamos los datos del cliente
    if (!datosClienteGlobal.hardwareId) {
        alert("Error: No se encontr√≥ el Hardware ID. Por favor, vuelve al paso anterior y completa tus datos.");
        return;
    }

    // Prevenir m√∫ltiples env√≠os
    if (isProcessing) {
        console.log("‚ö†Ô∏è Ya se est√° procesando una solicitud...");
        return;
    }

    isProcessing = true;

    // Mostrar indicador de carga si es posible
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<span class="loading-spinner"></span> Procesando...';
    button.disabled = true;

    try {
        // AQU√ç ES DONDE ENVIAMOS LOS DATOS AL CRM (AL FINAL DEL PROCESO)
        console.log("üéØ MOMENTO CLAVE: Enviando datos al CRM porque el cliente confirm√≥ el pago");
        
        // Actualizar m√©todo de pago final
        datosClienteGlobal.metodoPago = metodo;
        
        // Enviar datos al CRM SOLO AHORA
        const crmResult = await enviarDatosACRM(datosClienteGlobal);
        
        if (!crmResult || !crmResult.success) {
            console.error("‚ùå Error al registrar en CRM:", crmResult?.error);
            // Mostrar mensaje de error m√°s amigable pero continuar con WhatsApp
            alert("Hubo un problema al guardar tus datos, pero puedes continuar con el pago. Nuestro equipo revisar√° tu solicitud manualmente.");
        } else {
            console.log("‚úÖ Datos registrados exitosamente en CRM");
        }

        // Construir mensaje personalizado para WhatsApp
        const numeroWhatsApp = "51921566036";
        let mensaje = `Hola, acabo de realizar el pago por ${metodo} para activar WhatsApp Pro Sender.\n\n`;
        mensaje += `*Mi Nombre:* ${datosClienteGlobal.customerName}\n`;
        mensaje += `*Mi Email:* ${datosClienteGlobal.customerEmail}\n`;
        mensaje += `*Mi Hardware ID es:* ${datosClienteGlobal.hardwareId}\n\n`;
        mensaje += `Adjunto el comprobante de pago. ¬°Gracias!`;

        // Codificar mensaje para la URL
        const mensajeCodificado = encodeURIComponent(mensaje);

        // Crear y abrir la URL de WhatsApp
        const urlWhatsApp = `https://wa.me/${numeroWhatsApp}?text=${mensajeCodificado}`;
        
        // Abrir en una nueva pesta√±a
        window.open(urlWhatsApp, "_blank");

        // Tracking para analytics
        if (typeof gtag !== "undefined") {
            gtag("event", "whatsapp_voucher_sent", {
                "event_category": "Checkout",
                "event_label": "Voucher enviado por WhatsApp: " + metodo,
                "value": 25
            });
        }

        // Cerrar el modal despu√©s de un breve delay
        setTimeout(() => {
            const modal = bootstrap.Modal.getInstance(document.getElementById('checkoutModal'));
            if (modal) {
                modal.hide();
            }
            
            // Limpiar formulario despu√©s de cerrar el modal
            setTimeout(() => {
                limpiarFormulario();
            }, 500);
        }, 1500);

        console.log("üéâ PROCESO COMPLETADO: Datos registrados en CRM y WhatsApp abierto");

    } catch (error) {
        console.error("‚ùå Error en el proceso final:", error);
        alert(`Hubo un error al procesar tu solicitud: ${error.message}\n\nPor favor, int√©ntalo de nuevo o cont√°ctanos directamente por WhatsApp.`);
    } finally {
        // Restaurar bot√≥n
        button.innerHTML = originalText;
        button.disabled = false;
        isProcessing = false;
    }
}

    </script>

<!-- MODAL DE CHECKOUT COMPLETO -->
<div class="modal fade" id="checkoutModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-unlock"></i> 
                    Desbloquear Versi√≥n Completa - $25 USD
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            
            <div class="modal-body">
                <!-- PASO 1: Informaci√≥n del Cliente -->
                <div id="step1" class="checkout-step">
                    <h6 class="mb-3">üìã Paso 1: Tus Datos</h6>
                    <form id="customerForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre Completo *</label>
                                <input type="text" class="form-control" id="customerName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email *</label>
                                <input type="email" class="form-control" id="customerEmail" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">WhatsApp *</label>
                                <input type="text" class="form-control" id="customerWhatsApp" 
                                       placeholder="+51987654321" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Pa√≠s</label>
                                <select class="form-control" id="customerCountry">
                                    <option value="PE">üáµüá™ Per√∫</option>
                                    <option value="CO">üá®üá¥ Colombia</option>
                                    <option value="MX">üá≤üáΩ M√©xico</option>
                                    <option value="CL">üá®üá± Chile</option>
                                    <option value="OTHER">üåé Otro</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Hardware ID -->
                        <div class="mb-3">
                            <label class="form-label">üîß Hardware ID de tu Computadora *</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="hardwareId" 
                                       placeholder="Ejemplo: A1B2C3D4E5F6G7H8" required>
                                <button type="button" class="btn btn-outline-primary" onclick="showHardwareInstructions()">
                                    ‚ùì ¬øC√≥mo obtenerlo?
                                </button>
                            </div>
                            <small class="text-muted">
                                Necesario para generar tu licencia personalizada
                            </small>
                        </div>
                        
                        <!-- Instrucciones Hardware ID -->
                        <div id="hardwareInstructions" class="alert alert-info" style="display: none;">
                            <h6>üì± ¬øC√≥mo obtener tu Hardware ID?</h6>
                            <ol>
                                <li>Abre <strong>WhatsApp Pro Sender</strong> en tu computadora</li>
                                <li>Haz clic en <strong>"üîì Activar Versi√≥n Completa"</strong></li>
                                <li>Aparecer√° tu Hardware ID autom√°ticamente</li>
                                <li>C√≥pialo y p√©galo aqu√≠</li>
                            </ol>
                            <p class="mb-0">
                                <strong>Nota:</strong> Este ID es √∫nico para tu computadora y permite que la licencia 
                                funcione solo en tu equipo.
                            </p>
                        </div>
                        
                        <button type="button" class="btn btn-success w-100" onclick="goToStep2()">
                            Continuar al Pago ‚Üí
                        </button>
                    </form>
                </div>
                
                <!-- PASO 2: M√©todos de Pago -->
                <div id="step2" class="checkout-step" style="display: none;">
                    <h6 class="mb-3">üí≥ Paso 2: M√©todo de Pago</h6>
                    
                    <!-- Resumen -->
                    <div class="alert alert-success">
                        <h6>‚úÖ Datos Confirmados:</h6>
                        <p class="mb-1"><strong>Cliente:</strong> <span id="summaryName"></span></p>
                        <p class="mb-1"><strong>Email:</strong> <span id="summaryEmail"></span></p>
                        <p class="mb-0"><strong>Hardware ID:</strong> <span id="summaryHardware"></span></p>
                    </div>
                    
                    <!-- M√©todos de Pago -->
                    <div class="row g-3">
                        <!-- PayPal -->
                        <div class="col-md-4">
                            <div class="card h-100 payment-method" onclick="selectPaymentMethod('paypal')">
                                <div class="card-body text-center">
                                    <i class="fab fa-paypal fa-3x text-primary mb-3"></i>
                                    <h6>PayPal</h6>
                                    <p class="small text-muted">Pago seguro internacional</p>
                                    <span class="badge bg-success">Recomendado</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Transferencia Bancaria -->
                        <div class="col-md-4">
                            <div class="card h-100 payment-method" onclick="selectPaymentMethod('bank')">
                                <div class="card-body text-center">
                                    <i class="fas fa-university fa-3x text-success mb-3"></i>
                                    <h6>Transferencia</h6>
                                    <p class="small text-muted">Banco directo</p>
                                    <span class="badge bg-info">Seguro</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Yape/Plin -->
                        <div class="col-md-4" id="digitalWalletOption">
                            <div class="card h-100 payment-method" onclick="selectPaymentMethod('yapeplin')">
                                <div class="card-body text-center">
                                    <i class="fas fa-mobile-alt fa-3x text-danger mb-3"></i>
                                    <h6>Yape / Plin</h6>
                                    <p class="small text-muted">Pago m√≥vil Per√∫</p>
                                    <span class="badge bg-warning">R√°pido</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detalles de Pago (Inicialmente ocultos) -->
                    <div id="paypalDetails" class="payment-details mt-4" style="display: none;">
                        <div class="alert alert-info">
                            <h6>Pagar con PayPal:</h6>
                            <p>Haz clic en el bot√≥n de PayPal para completar tu pago de $25 USD.</p>
                            <a href="https://www.paypal.com/paypalme/antayperu/25" target="_blank" class="btn btn-primary w-100" onclick="enviarVoucherWhatsApp('PayPal')">
                                <i class="fab fa-paypal"></i> Pagar con PayPal
                            </a>
                        </div>
                    </div>
                    
                    <div id="bankDetails" class="payment-details mt-4" style="display: none;">
                        <div class="alert alert-info">
                            <h6>Pagar con Transferencia Bancaria:</h6>
                            <p>Realiza una transferencia de $25 USD a la siguiente cuenta:</p>
                            <p><strong>Banco:</strong> Banco de Cr√©dito del Per√∫ - BCP</p>
                            <p><strong>N√∫mero de Cuenta:</strong> 19473489211024</p>
                            <p><strong>CCI:</strong> 00219417348921102491</p>
                            <p><strong>Titular:</strong> Engels Camilo Ortega Fuentes Rivera</p>
                            <p>Una vez realizada la transferencia, env√≠a el comprobante por WhatsApp para activar tu licencia.</p>
                            <button type="button" class="btn btn-success" onclick="enviarVoucherWhatsApp('Transferencia Bancaria')">
                                üì± Enviar Voucher por WhatsApp
                            </button>
                        </div>
                    </div>
                    
                    <div id="yapePlinDetails" class="payment-details mt-4" style="display: none;">
                        <div class="alert alert-info">
                            <h6>Pagar con Yape / Plin:</h6>
                            <p>Realiza un Yape o Plin de S/ 94 (equivalente a $25 USD) al siguiente n√∫mero:</p>
                            <p><strong>N√∫mero:</strong> +51 921 566 036</p>
                            <p><strong>Titular:</strong> Engels Camilo Ortega Fuentes Rivera</p>
                            <p>Una vez realizado el pago, env√≠a el comprobante por WhatsApp para activar tu licencia.</p>
                            <button type="button" class="btn btn-warning" onclick="enviarVoucherWhatsApp('Yape/Plin')">
                                üì± Enviar Voucher por WhatsApp
                            </button>
                        </div>
                    </div>
                    
                    <button type="button" class="btn btn-secondary mt-3" onclick="goToStep1()">
                        ‚Üê Volver a Datos
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>
